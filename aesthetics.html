<!DOCTYPE html>

<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Colour Clustering</title>
  <LINK href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous" />
  <LINK rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
  <LINK href="styles.css" rel="stylesheet" type="text/css">

</head>
  <body id="home">
<img src="images/wideaesthetics.jpg" alt="wideaesthetics"  width=100% margin=0/>
 	
    <nav class="navbar navbar-expand-lg navbar-dark bg-secondary shadow-sm fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">Kokostino</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#projects">Projects</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#contact">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

	<h2>How to automatically group images by colour</h2>
<div class="container small_container" >
<p>
Imagine you want to print a photo book consisting of your 1000 favourite pictures with the goal to present it in an aesthetically pleasing way.
To do this - as we learned from some Instagram accounts - is by grouping pictures with similar colours.
</br>
We will do this by splitting the process into two steps:
<ol >
            <li> Find the dominant colours of an image using K-Medoids.</li></br></br>
<img src="images/KMe.png" alt="KMedoids"  width=50% margin=0 class="center"/></br></br>
            <li >Cluster images by similarity of their dominant colours using K-Means. </br></br>  </li>
<img src="images/KM.png" alt="KMeans"  width=50% margin=0 class="center"/></br></br>
</ol></p>

<h3>Extract the dominant colours with K-Medoids</h3>
<p>
K-Medoids is a clustering algorithm similar to K-Means, the difference being the cluster centers (centroids) 
not being at the geometric mean of the cluster but instead being the most central cluster data point itsself.
Why do we not just use K-Means, which is the more common and performant algorithm?
The answer has to do with how humans perceive similar colours vs how common colour spaces calculate similar colours.
The most common colour spaces, e.g. RGB or BGR, are three-dimensional Euclidean spaces.
K-Means for Euclidean spaces (or actually Euclidean metrics) works perfectly fine. The following cluster which was computed uses K-Means illustrates the weakness of KMeans and RGB-space:

<img src="images/cluster1.PNG"  width=50% margin-right=30 style="float:left"></br></br>
While the first two images are not completely far off, the last image is not matched well.
When we do the same computation with K-Medoids (top) we see that the dominant colours are extracted more realistically compared to K-Means (bottom).
</br></br></br>
<img src="images/MedvsMean.PNG" width=35%/>
</br></br></br>
One of the improvements of CIELAB and its metric compared to RGB is an improved illustration of lighting.
Taking into account that we want colour similarity as perceived by the human eye, 
we have to step into another colour space - CIELAB. 

The three coordinates in CIELAB are "L", "a" and "b". While a and b regulate the type of colour, L is the lighting.
It took decades to come up with a metric which is uniform, i.e. distances in that space are uniform compared to human perception of colour distance.
The first version "CIE76" from 1976 was an Euclidean metric but lacked uniformity. 
The metric "CIEDE 2000" improved a lot in regards of perceptual uniformity. It is non-Euclidean
and computations are slowed down quite a bit. The following formula shows the metric:</br></br>

<img src="images/ciede.PNG"  width=35% class="center"/></br></br>
with &#916;L' corresponding to the lighting L and &#916;C' and &#916;H' depending non-trivially on the coordinates a and b.
The other factors are constants.

</p>

<h3>Cluster similar colours with K-Means</h3>
<p>In the first step we scaled down each image to five colours. This makes it easier to define similarity to cluster them in a second step.
As an input for the K-Means clustering algorithm, two images get a "point" for each colour which is similar between those images.
The more similar colours, the more points. As similarity threshold I chose a distance in CIEDE 2000 of 5. 
Why 5? The human eye's sensitivity is around 2-3. Colours closer than this can't be separated by perception.
A distance of five is quite similar but without being overly restricted. Being to strict with the threshold
results in overcounting images which have a quite same colour but the remaining colours are not.
Since any distance above 5 counts as 0 similarity. This threshold is by far not perfect but as a first-third try it is decently successful.

</p>
<img src="images/clusters.jpg"  width=100% /></br></br>
<p>I ran the Python script with those two algorithms on the set of my 800 favourite photos.
I chose the numbers of clusters to be 200 (roughly correlating with the pages of the photobook). 
Above image shows five randomly clusters of my favourite images.
</p>
</div>
</body>
</html>